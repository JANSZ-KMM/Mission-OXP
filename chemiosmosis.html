<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>III: The Proton Odyssey: ATP Victory</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* SECTION: BASIC UTILITIES */
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 8s linear infinite; }
        
        body { 
            background-color: #020617; 
            margin: 0; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            font-family: 'Inter', sans-serif;
        }
        
        .protein-label { 
            font-size: 10px; 
            line-height: 1.1; 
            font-weight: 800; 
            white-space: nowrap; 
            pointer-events: none; 
            width: auto; 
            min-width: 80px;
        }

        /* SECTION: ATP SYNTHASE TURBINE ANIMATIONS */
        @keyframes turbine-rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-turbine { animation: turbine-rotate 3s linear infinite; }
        .animate-turbine-fast { animation: turbine-rotate 0.5s linear infinite; }

        /* SECTION: H+ PROTON PUMPING & DIFFUSION */
        @keyframes float-free {
            0%, 100% { transform: translate(0,0); }
            33% { transform: translate(8px, -5px); }
            66% { transform: translate(-5px, 3px); }
        }

        @keyframes pump-diffuse {
            0% { transform: translateY(0); opacity: 1; }
            50% { transform: translateY(-180px); opacity: 1; }
            85% { transform: translateY(-380px); opacity: 1; }
            100% { transform: translateY(-380px); opacity: 1; }
        }
        
        @keyframes float-post-pump {
            0%, 100% { transform: translateY(-380px) translate(0, 0); }
            50% { transform: translateY(-380px) translate(10px, -5px); }
        }

        .animate-pump-idle {
            animation: float-free 5s ease-in-out infinite;
        }

        .animate-pump-active { 
            animation: pump-diffuse 4s cubic-bezier(0.4, 0, 0.2, 1) forwards, float-post-pump 6s ease-in-out 4s infinite; 
        }

        /* DIFFUSION PATH THROUGH ATP SYNTHASE */
        @keyframes diffuse-down-scatter {
            0% { transform: translate(0, -380px); opacity: 0; }
            10% { opacity: 1; }
            60% { transform: translate(0, -50px); opacity: 1; } 
            100% { transform: translate(var(--scatter-x), var(--scatter-y)); opacity: 1; }
        }
        
        @keyframes float-post-diffuse-scatter {
            0%, 100% { transform: translate(var(--scatter-x), var(--scatter-y)); }
            50% { transform: translate(calc(var(--scatter-x) + 10px), calc(var(--scatter-y) - 10px)); }
        }

        .animate-diffuse { 
            animation: diffuse-down-scatter 1.8s cubic-bezier(0.45, 0.05, 0.55, 0.95) forwards, 
                       float-post-diffuse-scatter 5s ease-in-out 1.8s infinite; 
        }

        /* ATP FORMATION ANIMATIONS */
        @keyframes fuse-adp {
            0% { transform: translate(-60px, 40px); opacity: 0; }
            80% { transform: translate(0, 0); opacity: 1; }
            100% { transform: translate(0, 0); opacity: 0; }
        }
        @keyframes fuse-pi {
            0% { transform: translate(60px, 40px); opacity: 0; }
            80% { transform: translate(0, 0); opacity: 1; }
            100% { transform: translate(0, 0); opacity: 0; }
        }
        @keyframes fade-out-atp {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.2); }
        }
        @keyframes fade-out-ims {
            0% { opacity: 1; transform: translateY(-380px) scale(1); }
            10% { opacity: 0; transform: translateY(-380px) scale(0); }
            100% { opacity: 0; transform: translateY(-380px) scale(0); }
        }
        @keyframes nadh-oxidize {
            0% { transform: scale(1); opacity: 1; }
            20% { transform: scale(1.2); }
            40%, 100% { transform: scale(1); opacity: 0; }
        }
        @keyframes nad-appear {
            0%, 40% { opacity: 0; transform: scale(0.8); }
            60%, 100% { opacity: 1; transform: scale(1); }
        }

        /* CALIBRATED ELECTRON PATHS */
        @keyframes chain-flow-nadh {
            0%, 2% { transform: translate(65px, 400px); opacity: 0; }
            10%, 15% { transform: translate(265px, 110px); opacity: 1; } 
            25%, 30% { transform: translate(415px, 50px); opacity: 1; }  
            40%, 45% { transform: translate(520px, 110px); opacity: 1; } 
            55%, 60% { transform: translate(610px, 0px); opacity: 1; }  
            70%, 75% { transform: translate(735px, 110px); opacity: 1; } 
            85%, 100% { transform: translate(735px, 110px); opacity: 0; }
        }

        @keyframes chain-flow-fadh {
            0%, 2% { transform: translate(175px, 400px); opacity: 0; }
            10%, 15% { transform: translate(325px, 180px); opacity: 1; } 
            25%, 30% { transform: translate(415px, 50px); opacity: 1; }  
            40%, 45% { transform: translate(520px, 110px); opacity: 1; } 
            55%, 60% { transform: translate(590px, 5px); opacity: 1; }  
            70%, 75% { transform: translate(715px, 140px); opacity: 1; } 
            85%, 100% { transform: translate(715px, 140px); opacity: 0; }
        }

        .animate-chain-nadh { animation: chain-flow-nadh 10s forwards linear; }
        .animate-chain-fadh { animation: chain-flow-fadh 10s forwards linear; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const SunSymbol = ({ className, color="#FACC15" }) => (
            <svg viewBox="0 0 100 100" className={`${className} drop-shadow-[0_0_15px_rgba(251,191,36,0.8)]`} fill={color}>
                <circle cx="50" cy="50" r="20" />
                {[...Array(12)].map((_, i) => (
                    <rect key={i} x="47" y="10" width="6" height="15" rx="3" transform={`rotate(${i * 30} 50 50)`} />
                ))}
            </svg>
        );

        const FivePointStar = ({ className, color="#94a3b8", label="ADP" }) => (
            <div className={`relative flex items-center justify-center ${className}`}>
                <svg viewBox="0 0 100 100" className="w-full h-full" fill={color} stroke="#475569" strokeWidth="2">
                    <path d="M50 5 L61 40 L98 40 L68 60 L79 95 L50 75 L21 95 L32 60 L2 40 L39 40 Z" />
                </svg>
                <span className="absolute text-[8px] font-black text-slate-800">{label}</span>
            </div>
        );

        const SevenPointStar = ({ className, color="#FACC15", glow=false }) => (
            <svg viewBox="0 0 100 100" className={`${className} ${glow ? 'drop-shadow-[0_0_15px_rgba(251,191,36,0.8)]' : ''}`} fill={color} stroke="#854D0E" strokeWidth="1">
                <path d="M50,5 L58.9,34.5 L89.1,27.3 L72.7,53.4 L93.6,76.5 L63.6,74.5 L50,95 L36.4,74.5 L6.4,76.5 L27.3,53.4 L10.9,27.3 L41.1,34.5 Z" />
            </svg>
        );

        const App = () => {
            const [currentStep, setCurrentStep] = useState(0);
            const [completedTerms, setCompletedTerms] = useState([]);
            const [availableTerms, setAvailableTerms] = useState([]);
            const [showFinalSteps, setShowFinalSteps] = useState(false);
            const [showFinish, setShowFinish] = useState(false);
            const [synthesisPhase, setSynthesisPhase] = useState(0); 
            const [message, setMessage] = useState("");
            const audioContextRef = useRef(null);
            const lastPlayedStep = useRef(-1);

            const gameSequence = [
                { text: "free energy", step: 0 },
                { text: "H+", step: 1 },
                { text: "matrix", step: 2 },
                { text: "intermembrane space", step: 3 },
                { text: "proton pumps", step: 4 },
                { text: "proton gradient", step: 5 },
                { text: "proton-motive", step: 6 },
                { text: "chemiosmosis", step: 7 },
                { text: "oxidative phosphorylation", step: 8 }
            ];

            const narratorTexts = {
                0: "What is released from the movement of electrons along E.T.C.?",
                1: "What will be pumped and through what components?",
                5: "This proton pump will lead to what events?",
                7: "Which process involved when the H⁺ diffuse back through ATP synthase?",
                8: "The whole event is called as?"
            };

            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel(); // Stop current speech
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    window.speechSynthesis.speak(utterance);
                }
            };

            useEffect(() => {
                if (narratorTexts[currentStep] && lastPlayedStep.current !== currentStep) {
                    lastPlayedStep.current = currentStep;
                    speak(narratorTexts[currentStep]);
                }
            }, [currentStep]);

            const playSound = async (type) => {
                try {
                    if (!audioContextRef.current) audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                    const ctx = audioContextRef.current;
                    if (type === 'victory') {
                        const tempo = 0.15;
                        const playNote = (freq, start, duration) => {
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.type = 'square';
                            osc.frequency.setValueAtTime(freq, ctx.currentTime + start);
                            gain.gain.setValueAtTime(0.2, ctx.currentTime + start);
                            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + start + duration);
                            osc.connect(gain); gain.connect(ctx.destination);
                            osc.start(ctx.currentTime + start); osc.stop(ctx.currentTime + start + duration);
                        };
                        playNote(261.63, 0, tempo); playNote(329.63, tempo, tempo); playNote(392.00, tempo * 2, tempo); playNote(523.25, tempo * 3, tempo * 4);
                        return;
                    }
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain); gain.connect(ctx.destination);
                    if (type === 'correct') {
                        osc.frequency.setValueAtTime(600, ctx.currentTime);
                        osc.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.1);
                        gain.gain.setValueAtTime(0.2, ctx.currentTime);
                    } else {
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(150, ctx.currentTime);
                        gain.gain.setValueAtTime(0.2, ctx.currentTime);
                    }
                    osc.start(); osc.stop(ctx.currentTime + 0.2);
                } catch(e) {}
            };

            useEffect(() => {
                const phase1Terms = ["free energy", "H+", "matrix", "intermembrane space", "proton pumps"];
                setAvailableTerms([...phase1Terms].sort(() => Math.random() - 0.5));
            }, []);

            useEffect(() => {
                if (currentStep === 5) {
                   const timer = setTimeout(() => {
                        setShowFinalSteps(true);
                        const phase2Terms = ["proton gradient", "proton-motive", "chemiosmosis", "oxidative phosphorylation"];
                        setAvailableTerms([...phase2Terms].sort(() => Math.random() - 0.5));
                   }, 22000); 
                   return () => clearTimeout(timer);
                }
            }, [currentStep]);

            useEffect(() => {
                if (currentStep === 9) runAtpSequence();
            }, [currentStep]);

            const runAtpSequence = async () => {
                for(let i=1; i<=5; i++) {
                    setSynthesisPhase(i);
                    if (i === 3) {
                        setTimeout(() => setMessage("1 NADH produce 3 ATP"), 2500);
                        setTimeout(() => setMessage(""), 4500);
                    }
                    if (i === 5) {
                        setTimeout(() => setMessage("1 FADH₂ produce 2 ATP"), 2500);
                        setTimeout(() => setMessage(""), 4500);
                    }
                    await new Promise(r => setTimeout(r, 5000));
                }
                
                setTimeout(() => {
                    setShowFinish(true);
                    playSound('victory');
                }, 1000);
            };

            const handleDrop = (e, indexInSequence) => {
                e.preventDefault();
                const draggedText = e.dataTransfer.getData("text");
                const expected = gameSequence[indexInSequence];
                if (draggedText.toLowerCase() === expected.text.toLowerCase()) {
                    playSound('correct');
                    setCompletedTerms(prev => [...prev, { text: draggedText, step: indexInSequence }]);
                    setAvailableTerms(prev => prev.filter(t => t.toLowerCase() !== draggedText.toLowerCase()));
                    setCurrentStep(prev => prev + 1);
                } else { playSound('wrong'); }
            };

            const isDone = (stepIdx) => completedTerms.some(item => item.step === stepIdx);
            const formatDisplay = (text) => {
                if (text.toLowerCase() === "h+") return "H⁺";
                if (text.toLowerCase() === "proton gradient") return "proton gradient";
                if (text.toLowerCase() === "proton-motive") return "proton-motive";
                if (text.toLowerCase() === "oxidative phosphorylation") return "oxidative phosphorylation";
                return text;
            };
            const formatProteinDisplay = (text) => text.replace("NAD+", "NAD⁺");

            const PUMP_DELAYS = [1.5, 4.5, 7.5, 15.5, 18.5]; 
            const PUMP_X_POS = [220, 530, 770, 570, 810];
            
            const SCATTER_COORDS = [
                { x: -120, y: 15 }, 
                { x: -250, y: -10 }, 
                { x: -450, y: 20 }, 
                { x: -620, y: 0 }, 
                { x: -750, y: 15 }
            ];

            return (
                <div className="flex flex-col min-h-screen bg-slate-950 p-6">
                    <div className="flex justify-between items-center mb-6 h-16">
                        <div className="flex flex-col">
                            <h2 className="text-3xl font-black text-white uppercase tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-sky-400">III: The Proton Odyssey: ATP Victory</h2>
                            <div className="flex items-center gap-3">
                                <span className="text-sky-400 text-sm font-bold tracking-widest">
                                    Explore chemiosmosis and unlock ATP victory!
                                </span>
                            </div>
                        </div>
                        {showFinish && (
                            <button onClick={() => window.location.reload()} className="px-6 py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-black rounded-xl uppercase text-xs tracking-widest shadow-xl animate-bounce border-b-4 border-emerald-800">ATP Unlocked! Well done! →</button>
                        )}
                    </div>

                    <div className="flex flex-col gap-6 flex-1">
                        <div className="h-[500px] w-full relative border-[10px] border-slate-900 rounded-[3rem] overflow-hidden flex flex-col shadow-2xl bg-white">
                            <div className="h-[22%] bg-amber-50 relative flex items-center border-b-[4px] border-amber-100 px-10 overflow-hidden z-[50]">
                                <div className="absolute left-10 z-[60] flex flex-col">
                                    <span className="text-xs font-black text-black tracking-[0.05em] bg-white/40 px-2 py-0.5 rounded">Intermembrane space</span>
                                    <span className="text-[10px] font-bold text-amber-700 ml-1 mt-1">[H⁺] high</span>
                                </div>
                                {[...Array(8)].map((_, i) => (
                                    <div key={`ims-h-${i}`} className="absolute w-5 h-5 bg-yellow-300 rounded-full border border-yellow-500 flex items-center justify-center animate-pump-idle" style={{
                                        left: `${25 + i * 10}%`, top: `${15 + (i%2)*15}%`,
                                        animationDelay: `${i * 0.2}s`
                                    }}><span className="text-[8px] font-bold">H⁺</span></div>
                                ))}
                            </div>

                            <div className="h-[45%] bg-amber-100 relative flex items-center justify-start gap-8 px-56 border-y-[4px] border-amber-200 z-[100]">
                                <span className="absolute bottom-4 left-10 text-xs font-black text-black tracking-[0.05em] bg-white/40 px-2 py-0.5 rounded">Inner membrane</span>
                                <Protein type="integral" name="NADH dehydrogenase" formatFn={formatProteinDisplay} />
                                <Protein type="peripheral-matrix" name="Succinate dehydrogenase" formatFn={formatProteinDisplay} />
                                <Protein type="small" name="Coenzyme Q" formatFn={formatProteinDisplay} />
                                <Protein type="integral" name="Cytochrome c reductase" formatFn={formatProteinDisplay} />
                                <Protein type="surface" name="Cytochrome c" formatFn={formatProteinDisplay} />
                                <Protein type="integral" name="Cytochrome c oxidase" formatFn={formatProteinDisplay} />
                                <div className="ml-auto pr-8 h-full flex items-center">
                                    <Protein type="turbine" name="ATP synthase" active={synthesisPhase > 0} formatFn={formatProteinDisplay} />
                                </div>

                                <div className="absolute inset-0 pointer-events-none z-[150]">
                                    {currentStep >= 5 && (
                                        <>
                                            <div className="absolute top-0 left-0 flex items-center justify-center animate-chain-nadh" style={{animationDelay: '0.5s'}}>
                                                <SevenPointStar className="w-10 h-10 drop-shadow-[0_0_12px_rgba(251,191,36,1)]" />
                                                <span className="absolute text-[8px] font-black text-black">2e⁻</span>
                                            </div>
                                            <div className="absolute top-0 left-0 flex items-center justify-center animate-chain-fadh opacity-0" style={{animationDelay: `11.5s`}}>
                                                <SevenPointStar className="w-10 h-10 drop-shadow-[0_0_12px_rgba(251,191,36,1)]" />
                                                <span className="absolute text-[8px] font-black text-black">2e⁻</span>
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>

                            <div className="h-[33%] bg-emerald-50 relative border-t-[4px] border-emerald-100 z-[50]">
                                <div className="absolute bottom-4 left-10 z-[60] flex flex-col">
                                    <span className="text-[10px] font-bold text-emerald-700 ml-1 mb-1">[H⁺] low</span>
                                    <span className="text-xs font-black text-black tracking-[0.05em] bg-white/40 px-2 py-0.5 rounded">Matrix</span>
                                </div>

                                {message && (
                                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[200] bg-white/90 px-6 py-2 rounded-full border-2 border-emerald-500 shadow-xl animate-bounce">
                                        <span className="text-emerald-700 font-black uppercase tracking-widest text-sm">{message}</span>
                                    </div>
                                )}

                                <div className="absolute top-4 left-12 flex gap-12 z-[70]">
                                    <div className="relative flex flex-col items-center">
                                        <div className={`w-12 h-12 rounded-full flex items-center justify-center border-2 shadow-lg bg-orange-100 border-orange-400 ${currentStep >= 5 ? 'animate-[nadh-oxidize_2s_forwards]' : ''}`}>
                                            <span className="text-[10px] font-black tracking-tight text-orange-600">NADH</span>
                                        </div>
                                        <div className={`absolute top-0 w-12 h-12 rounded-full flex items-center justify-center border-2 shadow-lg bg-orange-50 border-orange-300 opacity-0 ${currentStep >= 5 ? 'animate-[nad-appear_2s_forwards]' : ''}`}>
                                            <span className="text-[10px] font-black tracking-tight text-orange-400">NAD⁺</span>
                                        </div>
                                    </div>

                                    <div className="relative flex flex-col items-center">
                                        <div className={`w-12 h-12 rounded-full flex items-center justify-center border-2 shadow-lg bg-red-100 border-red-400 ${currentStep >= 5 ? 'animate-[nadh-oxidize_2s_11s_forwards]' : ''}`}>
                                            <span className="text-[10px] font-black tracking-tight text-red-600">FADH₂</span>
                                        </div>
                                        <div className={`absolute top-0 w-12 h-12 rounded-full flex items-center justify-center border-2 shadow-lg bg-red-50 border-red-300 opacity-0 ${currentStep >= 5 ? 'animate-[nad-appear_2s_11s_forwards]' : ''}`}>
                                            <span className="text-[10px] font-black tracking-tight text-red-400">FAD</span>
                                        </div>
                                    </div>
                                </div>

                                {[...Array(2)].map((_, i) => (
                                    <div key={`resting-h-${i}`} className="absolute w-5 h-5 bg-yellow-300 rounded-full border border-yellow-500 flex items-center justify-center animate-pump-idle" style={{
                                        left: `${350 + i * 40}px`, bottom: '20px',
                                        animationDelay: `${i * 0.5}s`
                                    }}><span className="text-[8px] font-bold">H⁺</span></div>
                                ))}

                                {PUMP_X_POS.map((x, i) => {
                                    const isPumping = currentStep >= 5;
                                    const hasReturned = synthesisPhase > i;
                                    let currentAnimation = "";
                                    if (hasReturned) {
                                        currentAnimation = 'fade-out-ims 0.5s forwards';
                                    } else if (!isPumping) {
                                        currentAnimation = `float-free 5s ease-in-out ${i * 0.3}s infinite`;
                                    } 
                                    return (
                                        <div key={`big-h-${i}`} className={`absolute w-10 h-10 bg-yellow-300 rounded-full border-2 border-yellow-500 flex items-center justify-center shadow-lg ${isPumping ? 'animate-pump-active' : 'animate-pump-idle'}`} style={{left: `${x - 20}px`, bottom: '40px', animationDelay: isPumping ? `${PUMP_DELAYS[i]}s` : `${i * 0.3}s`, animation: hasReturned ? 'fade-out-ims 0.5s forwards' : ''}}>
                                            <span className="text-sm font-black text-yellow-800">H⁺</span>
                                        </div>
                                    );
                                })}

                                {[...Array(5)].map((_, i) => {
                                    if (synthesisPhase < i + 1) return null;
                                    const scatter = SCATTER_COORDS[i];
                                    return (
                                        <div key={`synth-seq-${i}`} className="absolute inset-0">
                                            <div 
                                                className="absolute w-10 h-10 bg-yellow-300 rounded-full border-2 border-yellow-500 flex items-center justify-center animate-diffuse shadow-lg z-[80]" 
                                                style={{
                                                    right: '270px', 
                                                    bottom: '50px',
                                                    '--scatter-x': `${scatter.x}px`,
                                                    '--scatter-y': `${scatter.y}px`
                                                }}
                                            >
                                                <span className="text-sm font-black text-yellow-800">H⁺</span>
                                            </div>
                                            
                                            <div className="absolute right-[20px] bottom-[30px] w-[250px] h-[100px] flex items-center justify-center animate-[fade-out-atp_0.5s_4s_forwards] z-[10]">
                                                <div className="relative flex items-center justify-center w-full">
                                                    <div className="flex items-center gap-4 relative z-10">
                                                        <FivePointStar className="w-12 h-12 animate-[fuse-adp_1.2s_ease-out_1.5s_forwards] opacity-0" />
                                                        <div className="w-8 h-8 rounded-full bg-blue-400 border-2 border-blue-600 flex items-center justify-center animate-[fuse-pi_1.2s_ease-out_1.5s_forwards] opacity-0 shadow-md">
                                                            <span className="text-[10px] font-black text-white">Pi</span>
                                                        </div>
                                                        <div className="absolute inset-0 flex flex-col items-center justify-center opacity-0 animate-[fade-in_0.3s_2.6s_forwards]">
                                                            <SunSymbol className="w-26 h-26" />
                                                            <span className="absolute text-[14px] font-black text-amber-900">ATP</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="flex-1 min-h-[300px] p-8 bg-slate-900 rounded-[2rem] border border-slate-800 shadow-xl relative font-bold text-white flex flex-col justify-between">
                            <div className="text-xl leading-relaxed mb-6">
                                {!showFinalSteps ? (
                                    <div className="space-y-4">
                                        <div>11. In chemiosmosis, the movement of electrons along the electron transport chain releases <Drop target="free energy" done={isDone(0)} active={currentStep===0} onDrop={(e) => handleDrop(e, 0)} formatFn={formatDisplay} /></div>
                                        {(currentStep >= 1 || isDone(1)) && (
                                            <div>12. that used to pump <Drop target="H+" done={isDone(1)} active={currentStep===1} onDrop={(e) => handleDrop(e, 1)} formatFn={formatDisplay} /> from <Drop target="matrix" done={isDone(2)} active={currentStep===2} onDrop={(e) => handleDrop(e, 2)} formatFn={formatDisplay} /> of mitochondria into <Drop target="intermembrane space" done={isDone(3)} active={currentStep===3} onDrop={(e) => handleDrop(e, 3)} formatFn={formatDisplay} /> via the <Drop target="proton pumps" done={isDone(4)} active={currentStep===4} onDrop={(e) => handleDrop(e, 4)} formatFn={formatDisplay} />: NADH dehydrogenase, cytochrome c reductase and cytochrome c oxidase.</div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        <div>13. Accumulation of H⁺ in the intermembrane space leads to production of <Drop target="proton gradient" done={isDone(5)} active={currentStep===5} onDrop={(e) => handleDrop(e, 5)} formatFn={formatDisplay} /> and generates <Drop target="proton-motive" done={isDone(6)} active={currentStep===6} onDrop={(e) => handleDrop(e, 6)} formatFn={formatDisplay} /> force.</div>
                                        {(currentStep >= 7 || isDone(7)) && (
                                            <div>14. H⁺ from intermembrane space diffuse back into matrix of mitochondria through ATP synthase via <Drop target="chemiosmosis" done={isDone(7)} active={currentStep===7} onDrop={(e) => handleDrop(e, 7)} formatFn={formatDisplay} /> down its concentration gradient.</div>
                                        )}
                                        {(currentStep >= 8 || isDone(8)) && (
                                            <div>15. ATP synthase catalyze the phosphorylation of ADP to ATP by <Drop target="oxidative phosphorylation" done={isDone(8)} active={currentStep===8} onDrop={(e) => handleDrop(e, 8)} formatFn={formatDisplay} />.</div>
                                        )}
                                    </div>
                                )}
                            </div>
                            <div className="flex flex-wrap gap-4 justify-center pb-4">
                                {availableTerms.map((t, i) => (
                                    <div key={i} draggable onDragStart={(e) => e.dataTransfer.setData("text", t)} className="px-6 py-3 bg-sky-600 hover:bg-sky-500 text-white rounded-xl font-black text-sm cursor-grab active:scale-95 transition-all uppercase tracking-widest shadow-lg border-b-4 border-sky-800">{formatDisplay(t)}</div>
                                ))}
                            </div>
                        </div>
                    </div>

                    <style>{`
                        @keyframes fade-in { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
                    `}</style>
                </div>
            );
        };

        const Drop = ({ target, done, active, onDrop, formatFn }) => (
            <span onDragOver={e => e.preventDefault()} onDrop={onDrop} className={`inline-flex items-center justify-center min-w-[140px] px-3 mx-1 rounded-lg transition-all border-2 align-middle font-black text-base ${done ? "text-sky-300 border-sky-500/30 bg-sky-500/10" : active ? "border-red-400 border-dashed bg-red-500/20 animate-pulse text-red-500 text-xl" : "border-slate-700 border-dashed bg-slate-800/50 text-transparent h-7"}`}>{done ? formatFn(target) : (active ? "?" : "")}</span>
        );

        const Protein = ({ type, name, formatFn, active }) => {
            const label = formatFn(name);
            if (type === "integral") return <div className="relative flex flex-col items-center justify-center w-16 h-[130%] rounded-2xl border-2 bg-gradient-to-b from-sky-400 to-sky-600 border-sky-300 ring-2 ring-white/20 shadow-lg z-10"><div className="protein-label text-center px-1 text-black">{label}</div></div>;
            if (type === "peripheral-matrix") return <div className="relative flex flex-col items-center self-end h-24 mb-[-3.5rem] z-10"><div className="w-16 h-12 rounded-2xl border-2 flex items-center justify-center bg-gradient-to-b from-sky-400 to-sky-600 border-sky-300 ring-2 ring-white/20 shadow-lg"><div className="protein-label text-center text-black px-1 leading-tight">{label}</div></div></div>;
            if (type === "small") return <div className="relative flex flex-col items-center justify-center w-14 h-14 rounded-full border-2 -mt-12 bg-gradient-to-b from-sky-400 to-sky-600 border-sky-300 ring-2 ring-white/20 shadow-lg z-10"><div className="protein-label text-center px-1 text-black">{label}</div></div>;
            if (type === "surface") return <div className="relative flex flex-col items-center justify-center w-12 h-12 rounded-full self-start -mt-8 border-2 bg-gradient-to-b from-sky-400 to-sky-600 border-sky-300 ring-2 ring-white/20 shadow-lg z-10"><div className="protein-label text-center px-1 text-black">{label}</div></div>;
            if (type === "turbine") return <div className="relative flex flex-col items-center w-16 h-full z-10"><div className="w-14 h-1/2 border-2 bg-gradient-to-b from-purple-400 to-purple-600 border-purple-300 rounded-lg shadow-sm flex items-center justify-center relative -mt-10"></div><div className="w-4 h-6 border-x-2 bg-gradient-to-b from-purple-400 to-purple-600 border-purple-300"></div><div className="w-20 h-20 -mt-2 border-2 bg-gradient-to-b from-purple-400 to-purple-600 border-purple-300 rounded-full shadow-lg flex items-center justify-center relative transition-all duration-300"><div className={`absolute inset-0 opacity-20 ${active ? 'animate-turbine-fast' : 'animate-turbine'}`}><div className="absolute top-0 left-1/2 -translate-x-1/2 w-2 h-full bg-white"></div><div className="absolute left-0 top-1/2 -translate-y-1/2 w-full h-2 bg-white"></div></div><div className="protein-label text-center px-1 z-10 text-white">{label}</div></div></div>;
            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>